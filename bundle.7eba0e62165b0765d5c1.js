(()=>{"use strict";var e=["Художественная литература","Научная литература","Детская литература","Бизнес-литература"],t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},o={};t.d(o,{Z:()=>r});const r=class{constructor(e="localStorageDB"){this.name=e,this.storage=void 0===window.localStorage?void 0:window.localStorage,this.supported=void 0!==this.storage}parseValue(e){let t;try{t=JSON.parse(e),void 0===t&&(t=e),"true"===t&&(t=!0),"false"===t&&(t=!1),window.parseFloat(t)===t&&"object"!=typeof t&&(t=window.parseFloat(t))}catch(o){t=e}return t}set(e){let t=this.get(),o=t?Object.assign(t,e):e,r=JSON.stringify(o);return this.storage.setItem(this.name,r),this.parseValue(r)}get(e){let t=this.storage.getItem(this.name);return t=this.parseValue(t),e?t?t[e]:null:t}remove(e){let t=this.storage.getItem(this.name);if(t=this.parseValue(t),e){if(t&&t[e]){delete t[e];let o=JSON.stringify(t);this.storage.setItem(this.name,o)}}else this.storage.removeItem(this.name);return!0}clearAll(){this.storage.removeItem(this.name)}};var n=function(){return n=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n.apply(this,arguments)},a=new(0,o.Z);a.get("books")||a.set({books:[]});var i=null,l=null,c="",s=document.querySelector(".create-title"),u=document.querySelector(".create-author"),d=document.querySelector(".create-category"),v=document.querySelector(".saveButton"),f=document.querySelector(".search-input"),h=document.querySelector(".categoryList"),g=document.querySelector(".bookList"),m=document.getElementById("book-item-template"),p=document.querySelector(".header_statistics__text_total");function y(){var e;p.textContent="Всего книг: ".concat((null===(e=a.get("books"))||void 0===e?void 0:e.length)||0)}function b(e){h.querySelectorAll("li").forEach((function(t){t.classList.toggle("selected",t.textContent===e)}))}function k(e){g.innerHTML="",e.forEach((function(e){var t=E(e);g.appendChild(t)}))}function S(e){k(a.get("books").filter((function(t){return t.category===e})))}function E(e){var t=m.content.firstChild.cloneNode(!0);t.querySelector(".book-title-item__text").textContent=e.title,t.querySelector(".book-author-item__text").textContent=e.author,t.querySelector(".book-category-item__text").textContent=e.category;var o=t.querySelector(".book-item__delete"),r=t.querySelector(".book-item__edit");return o.addEventListener("click",(function(){!function(e,t){var o=a.get("books");o=o.filter((function(e){return e.id!==t})),a.set({books:o}),e.remove(),y()}(t,e.id)})),r.addEventListener("click",(function(){!function(e,t){var o=a.get("books"),r=null==o?void 0:o.findIndex((function(e){return e.id===t}));void 0!==r&&(i=o[r],s.value=i.title,u.value=i.author,d.value=i.category,v.textContent="Сохранить изменения")}(0,e.id)})),t}f.addEventListener("input",(function(){var e=f.value.toLowerCase(),t=a.get("books").filter((function(t){return t.title.toLowerCase().includes(e)||t.author.toLowerCase().includes(e)}));l&&k(t.filter((function(e){return e.category===l})))})),v.addEventListener("click",(function(e){e.preventDefault();var t=s.value,o=u.value,r=d.value,h=!1;if(""===t?(s.classList.add("titleError"),h=!0):s.classList.remove("titleError"),""===o?(u.classList.add("authorError"),h=!0):u.classList.remove("authorError"),h)setTimeout((function(){s.classList.remove("titleError"),u.classList.remove("authorError")}),1e3);else{if(i){var m=a.get("books"),p=null==m?void 0:m.findIndex((function(e){return e.id===i.id}));-1!==p&&(m[p]=n(n({},m[p]),{title:t,author:o,category:r})),a.set({books:m}),i=null,v.textContent="Добавить книгу",k(a.get("books")),d.value=l,S(l),f.value=c}else!function(e,t,o){var r=a.get("books"),n=Math.max.apply(Math,function(e,t,o){if(o||2===arguments.length)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}([0],r.map((function(e){return e.id})),!1))+1,i=E({id:n,title:e,author:t,category:o});r.push({id:n,title:e,author:t,category:o}),a.set({books:r}),g.prepend(i),y()}(t,o,r),d.value=l,S(l),f.value=c;s.value="",u.value=""}})),e.forEach((function(e){var t=document.createElement("option");t.value=e,t.textContent=e,d.appendChild(t)})),e.forEach((function(e){var t=document.createElement("li");t.textContent=e,t.addEventListener("click",(function(){l=e,S(e),b(e),f.value="",c=""})),h.appendChild(t)})),y(),k(a.get("books")||[]),e.length>0&&(l=e[0],S(e[0]),b(e[0]))})();